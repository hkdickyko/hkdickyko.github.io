---
category: [積體電路]
tags: [IoT, 電子]
title: ESP 温湿度探测器
date: 2024-08-18 1:00:00
---

<style>
  table {
    width: 100%
    }
  td {
    vertical-align: center;
    text-align: center;
  }
  table.inputT{
    margin: 10px;
    width: auto;
    margin-left: auto;
    margin-right: auto;
    border: none;
  }
  input{
    text-align: center;
    padding: 0px 10px;
  }
  iframe{
    width: 100%;
    display: block;
    border-style:none;
  }
</style>


# 温湿度探测器

AHT10 配有 ASIC 专用芯片、一个半导体电容式湿度传感元件和一个标准的片上温度传感元件，在恶劣环境下的性能稳定。每一个传感器都经过校准和测试。

  应用范围主要在暖通空调 、除湿器、测试及检测设备、消费品、汽车 、自动控制、数据记录器、气象站、家电、湿度调节、医疗及其他相关温湿度检测控制。



器件地址为 0x38 ，最后一位是读写位，需要空出一位给读写位 (写=0，读=1)，因此需要左移一位。

- 即写为 0x38 << 1 | 0x00 得到 0X70 
- 即读为 0x38 << 1 | 0x01 得到 0X71 

![Alt aht10address](../assets/img/esp/aht10address.png)


|比特位|意义|描述|
|:---:|:---:|:---|
|Bit［7］|忙闲指示|1＝设备忙，处于测量模式<br/>0＝设备闲，处于休眠模式|
|Bit［6～5］|读取工作模式|00 = 当前处于 NOR 模式<br/>01 = 当前处于 CYC 模式<br/>11 = 当前处于 CMD 模式|
|Bit［4］|保留|保留|
|Bit［3］|校准使能位|1＝已校准<br/>0＝未校准|
|Bit［2～0］|保留|保留|


 - 接驳电源
 - 延时 **50**ms 让传感器稳定
 - 器件地址左移 **1** 位+写 0x70
 - 初始化校准 0xE1 0x08 0x00
 - 延时 **50**ms 让传感器稳定
 - 等待传感器应答
 - 器件地址左移 **1** 位+写 0x70
 - 发送触发测量命令 0xAC
 - 等待传感器应答
 - 发送数据位 0x33
 - 等待传感器应答
 - 发送数据位 0x00
 - 等待传感器应答
 - 停止信号（可不加）
 - 起始信号
 - 器件地址左移1位+读 0x71
 - 等待传感器应答，
 - 读取 **8** 位数据（状态字）
 - 主机发送应答
 - 读取湿度高位数据
 - 主机发送应答
 - 读取湿度低位数据
 - 主机发送应答
 - 读取湿度最后4位数据和温度最高的 **4** 位数据 -> -> 
 - 主机发送应答
 - 读取温度8数据
 - 主机发送应答
 - 读取温度8位数据
 - 主机发送应答
 - 停止信号。












I2C 地址：0x38

软件重置：需要时间 < 20ms。需要时使用，指令 0xBA

启始设定：0xE1 

第一次开机时设定指令：

 - 需要跟次序：0xE1 -> 0x08 -> 0x00

初始化之后，必须先取得状态码 BIT3 为 1（calibrated），则表示 AHT10 初始化完成，之后的温湿度数据才有意义。 

但状态码的取得与数据，在数据内是包在一起的指令。 故实作时当尝试部份读取或全读取。
如 BIT3 为零，则需软件重置并且重新 启始设定重覆以上步骤直至成功。

接着每要读取一笔数据，便需发一次触发量测的命令。  

IIC WRITE -> 0xAC -> 0x33 -> 0x00

因需要此命令，才能取得最新的状态码。指令后的延迟时间是 75ms 使得可以取得完成的有效数据。

以上成功之后便可做数据的读取如下：

IIC READ -> 状态码（1-byte）-> 湿度（1-byte）-> 湿度（1-byte）-> 湿温度（4-bit 湿度4-  bit 温度） -> 温度（1-byte）-> 温度（1-byte）

其中，状态码 BIT7 代表 AHT10 是否正在取样。 若其值 1，则表示数据数值无效探测器忙碌中（busy）。 这表示了，是否只要部份读取是可行的，当数据无效时。


最后看到数据有 20 bits。 但根据算式，可知用上 20 bits 意义不大。 因此可以改写算式，基于 10 bits 的精细度是 1/1024 = 0.000976562 定为 

$$
RdRateH，RdRateT = 1/2048 = 0.000488281。
$$

## 湿度

$$
湿度 = (MSB 10-bit H-data) x RdRateH x 100%
$$

## 温度

因计算上温度还有进一步放大 **200** 倍，原始数据 (raw data) 该更精细，offset 50。 因 10-bit 是千分之一的精确度，11-bit 便足以应付此放大。 故，

$$
温度 = (MSB 11-bit T-data) x RdRateT x 200 – 50
$$

则温度便可精确到小数点下第一位。