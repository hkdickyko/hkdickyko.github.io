---
category: [積體電路]
tags: [IoT, 编程]
title: PID 控制
date: 2024-10-3 1:00:00
---
<style>
  table {
    width: 100%
    }
  td {
    vertical-align: center;
    text-align: center;
  }
  table.inputT{
    margin: 10px;
    width: auto;
    margin-left: auto;
    margin-right: auto;
    border: none;
  }
  input{
    text-align: center;
    padding: 0px 10px;
  }
  iframe{
    width: 100%;
    display: block;
    border-style:none;
  }
</style>

# PID 控制

## 参数调试方法 (PID)

Proportion-Integral-Differential (比例-积分-微分) 方法如下

![Alt pid](../assets/img/esp/pidg.png)


$$
r(t) -c(t) = e(t) \\
u(t) = K_p \times e + K_i \times \int_{0}^{\Delta t}e \Delta t + K_d \times \frac {\Delta e}{\Delta t} 
$$

（式中的 $t$ 为时间，$e$ 误差 即对时间积分、微分）如果没有误差，即 $e=0$，
 - 则 $K_p e = 0$； 
 - $ K_d  \frac {\Delta e}{\Delta t} = 0 $；
 - 而 $K_i \int_{0}^{\Delta t}e \Delta t $ 不一定为 $0$。

三项之和不一定为 $0$。如果“误差”存在，**PID** 就会对电机驱动作调整，直到误差 $PID_e=0$。 评价一个控制系统是否优越，有三个指标：快、稳、准。

 - 快，就是要使压力能快速地达到 **命令值**，可以增大 $Kp$ 值。
 - 稳，就是要压力稳定不波动或波动量小，可以增大 $K_d$，值可以减少压力波动。微分控制一般不用于速度很低的物体。如使用可能会出现突然速度改变。
 - 准，就是要求 **命令值** 与 **输出值** 之间的误差 $e$ 小，可以增大 $K_i$ 值。减少静态误差，但仍会存在动态误差。因动态误差是系统的跟踪特性。
 
仔细分析可以得知：这三个指标是相互矛盾的。如果太“快”，可能导致不“稳”；如果太“稳”，可能导致不“快”； 

![Alt pid](../assets/img/esp/pidcomp.png)

设置PID参数的建议步骤：

 - 把 $K_i$ 与 $K_d$ 设为 $0$，不要积分与微分；
 - 把 $K_p$ 值从 0 开始慢慢增大，观察压力的反应速度是否在你的要求内； 
 - 当压力的反应速度达到你的要求，停止增大 $K_p$ 值； 
 - 在该 $K_p$ 值的基础上减少 **10**%； 
 - 把 $K_i$ 值从 $0$ 开始慢慢增大；
 - 当压力开始波动，停止增大 $K_i$ 值；
 - 在该 $K_i$ 值的基础上减少 **10**%；
 - 把 $K_d$ 值从 $0$ 开始慢慢增大，观察压力的反应速度是否在要求内。

 ![Alt pid](../assets/img/esp/pidcurve.gif)

 ## 卡尔曼滤波（Kalman Filter）

卡尔曼滤波是一种用于状态估计和数据融合的强大数学和统计工具，是一种递归的、最优的状态估计方法，通常用于处理含有噪声的时间序列数据，以估计系统的状态，同时提供估计的不确定性。

卡尔曼滤波的主要用途包括：

 - 状态估计
    - 可以用于估计线性或非线性动态系统的状态变量，尤其是在系统中存在不完全或噪声观测的情况下。这对于跟踪运动物体、导航、定位以及环境感知等应用非常有用。
 - 数据融合
    - 可以将多个传感器提供的信息融合在一起，以提供更准确的估计，降低估计误差。
 - 控制系统
    - 还用于控制系统，以估计系统状态并制定控制策略，从而实现系统的自动控制。

卡尔曼滤波基于状态空间模型，其中系统状态通过线性或非线性动态模型演化，并且由观测模型通过传感器观测进行测量。卡尔曼滤波使用贝叶斯估计方法来不断更新系统状态的估计，考虑了过去的状态估计和新的观测数据，以提供最优的状态估计结果。卡尔曼滤波的主要目标是最小化估计误差的方差，从而提供最优的状态估计结果。

卡尔曼滤波有多个变种，包括扩展卡尔曼滤波（Extended Kalman Filter，EKF）和无迹卡尔曼滤波（Unscented Kalman Filter，UKF），用于处理非线性系统。

## 小波变换（Wavelet Transform）

小波变换（Wavelet Transform）是一种用于信号处理和数据分析的数学方法。它是一种多尺度分析技术，可以将信号分解成不同尺度和频率的分量，以便更好地理解信号的局部特征和结构。小波变换在许多领域，包括信号处理、图像处理、数据压缩和模式识别等方面都有广泛的应用。

小波变换的主要特点包括：

 - 多尺度分析
    - 能够在不同尺度上分解信号，因此可以检测信号中的局部特征，从高频细节到低频整体。
 - 时频局部性
    - 与傅立叶变换不同，小波变换具有时频局部性，可以在时间和频率上同时分析信号。这使得它在分析非平稳信号和非线性信号时非常有用。
 - 数据压缩
    - 可以用于数据压缩，通过保留主要的小波系数，可以减小数据的存储空间和传输带宽。
 - 特征提取
    - 可以用于从信号中提取特征，用于模式识别、分类和检测任务。

小波变换有两种主要类型：连续小波变换（Continuous Wavelet Transform，CWT）和离散小波变换（Discrete Wavelet Transform，DWT）。

连续小波变换（CWT）是一种在不同尺度上滑动小波函数，对信号进行连续分解的方法。CWT的主要特点是它提供了连续的尺度信息，但计算成本较高。

离散小波变换（DWT）是一种通过滤波和下采样操作将信号分解成不同尺度的方法。DWT通过将信号分解成高频和低频部分，然后继续对低频部分进行分解，从而实现多尺度分析。DWT的计算效率高，适用于实际工程应用。

## Savitzky-Golay 滤波器

Savitzky-Golay滤波是一种信号处理技术，用于对离散数据序列进行平滑和去噪。它是一种线性平滑滤波器，通过拟合多项式来估计数据点的平均值，以减小噪声和突发波动。Savitzky-Golay滤波器的主要思想是在局部窗口内对数据进行多项式拟合，从而获得平滑后的估计值。

Savitzky-Golay滤波的主要特点包括：

 - 局部拟合
    - 使用一个固定大小的局部窗口来拟合多项式，通常窗口大小为奇数。对于每个数据点，它使用窗口内的数据点来执行多项式拟合，以获得该点的平滑估计值。
 - 多项式拟合
    - 使用多项式来拟合窗口内的数据点。常用的多项式阶数是2（二次多项式）或4（四次多项式），但可以根据需要选择不同的阶数。
 - 数据平滑
    - 旨在平滑数据，减小数据中的高频噪声和突发波动。它保留了数据中的趋势和主要特征，同时去除了噪声。
 - 适用性
    - 适用于各种领域，包括信号处理、光谱分析、化学分析、生物医学数据处理和图像处理等。它特别适用于光谱数据，因为它可以去除仪器噪声和光谱线的窄化。
 - 平滑度可调
    - 通过调整窗口大小和多项式阶数，可以控制滤波器的平滑度。较大的窗口和较高的多项式阶数可以提供更平滑的结果，而较小的窗口和较低的多项式阶数可以更好地保留数据的细节。

Savitzky-Golay滤波器是一种有效的数据平滑和去噪技术，它可以在许多领域用于处理具有噪声的数据，以提高数据的可解释性和分析能力。

