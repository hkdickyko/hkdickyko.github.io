---
category: [編程]
tags: [編程]
title: C 工具 (Linux)
date: 2022-06-01 06:00:00
---

# C 工具(Linux)

## clang-format (格式化)

Clang-Format可用於格式化（排版）多種不同語言的程式碼。其自帶的排版格式主要有：
 - LLVM
 - Google
 - Chromium
 - Mozilla
 - WebKit

安裝方式：

```shell
sudo apt-get install clang-format
```

基本使用，用 <font color="#FF1000">LLVM</font> 程式碼風格格式化 *main.cpp*, 結果直接寫到 *main.cpp*

```shell
clang-format -style=LLVM -i main.cpp
```

全部目錄下的 cpp / hpp / c / h 檔案也用 LLVM 風格格式化，並直接更新檔案。

```shell
find . -regex '.*\.\(cpp\|hpp\|c\|h\)' -exec clang-format -style=LLVM -i {} \;
```

## valgrind (抓內存洩漏)

Valgrind 是用於構建動態分析的工具。包括工具集，每個工具執行某種類型的調試、分析或類似的任務，幫助完善程序設計。Valgrind 的架構是模塊化的，可以容易的創建新的工具而又不會擾亂現有的結構。

 提供的有用工具如下：
 - Memcheck 是一個內存錯誤偵測器;
 - Cachegrind 是一個緩存和分支預測分析器;
 - Callgrind 是一個調用圖緩存生成分析器;
 - Helgrind 是一個線程錯誤檢測器;
 - DRD 也是一個線程錯誤檢測器;
 - Massif 是一個堆分析器;
 - DHAT 是另一種不同的堆分析器;
 - SGcheck 是一個仍處於試驗狀態的工具，用來檢測堆和全局數組的溢出。

安裝方式：

```shell
sudo apt-get install valgrind
```

基本使用格式

```shell
valgrind [options] prog-and-args
```
基本使用

```shell
valgrind --tool=memcheck ./test
```
接下來我們要展示 Valgrind 更加強大的功能。它展示了程序的內存使用情況，並且給出總結:

 - definitely lost: 肯定的內存洩漏，這表示在程序退出時，有內存沒有回收，但是也沒有指針指向該內存。 這種情況最為嚴重。

 - indirectly lost: 間接的內存洩漏，如類之中定義的指針指向的內存沒有回收。 這種情況和上述相同。

 - possibly lost： 可能出現內存洩漏。 這種情況需要仔細排查，可能代碼沒有問題，也可能有異常的內存洩露。

 - still reachable: 程序沒主動釋放內存，在退出時候該內存仍能訪問到。 這種情況一般問題不大，因為程序退出之後操作系統會回收程序的內存，所以這種情況一般問題不大。

 這裡沒有給出具體洩露的內容，需要加入數 --leak-check=full 將完整的結果打印出來，會指出對應的引起內存洩露的具體代碼，可以繼續深入分析。















