---
category: [軟件]
tags: [系統, Linux]
title: mqtt 傳 IP
date: 2023-06-13 1:00:00
---

# mqtt 傳 IP 地址

基於沒有網址。可以使用 mqtt 格式及免費網站。傳輸 ip 地址到需要的設備。

## 安裝 nodeJS

```
$ sudo apt install nodejs npm -y
```

## mqtt 發放 ip 地址

```
var mqtt = require("mqtt");

const options = {
  protocol: 'tcp',
  host: 'broker.hivemq.com',
  port: 1883,
};

var client = mqtt.connect(options);

function getIPAddress() {
  let interfaces = require('os').networkInterfaces();
  for (let devName in interfaces) {
    let iface = interfaces[devName];
    for (let i = 0; i < iface.length; i++) {
      let alias = iface[i];
      if (alias.family === 'IPv4' && alias.address !== '127.0.0.1' && !alias.internal)
        return alias.address;
    }
  }
  return '0.0.0.0';
}


// 将有效輸出資料设置为 空白 并將 retain 設为 true 以清除服务器信息。
client.publish('dicky', getIPAddress(), { retain: true, qos: 1 }, (err) => {
  if (err) {
    console.error('Failed to publish message:', err);
  } else {
    console.log('已发布 ip 地址！');
    client.end();
  }
});
```