---
category: [積體電路]
tags: [IoT, 電子]
title: ESP ST7789 显示屏
date: 2024-09-24 1:00:00
---

<style>
  table {
    width: 100%
    }
  td {
    vertical-align: center;
    text-align: center;
  }
  table.inputT{
    margin: 10px;
    width: auto;
    margin-left: auto;
    margin-right: auto;
    border: none;
  }
  input{
    text-align: center;
    padding: 0px 10px;
  }
  iframe{
    width: 100%;
    display: block;
    border-style:none;
  }
</style>

# ESP ST7789 显示屏

ST7789 是一款高度集成的液晶显示控制器芯片。它支持RGB565 / 666 / 888格式的彩色显示，最大60帧/秒的刷新率。ST7789 还具有广泛的接口选择，包括SPI和 8/9/16/18 位并行总线接口。

|編號|	名稱|	方向	|功能|
|:---:|:---:|:---:|:---|
|1	|GND	|	|LCD 熒幕 接地<br/>(TFT IPS LCD 引腳)|
|2	|VCC|		|LCD 熒幕 電源，接受 5V<br/>(TFT IPS LCD 引腳)|
|3	|SCL	|輸入|	序列時脈，資料由高至低取值每8位元資料為1週期|
|4	|SDA	|輸入|	序列資料|
|5	|RES	|輸入	|低電壓時，重置所有控制模式的設定值若果不需要重置，保持高電壓<br/>(TFT IPS LCD 引腳)|
|6	|DC|	輸入	|低電壓時，為控制模式高電壓時，為資料模式<br/>(TFT IPS LCD 引腳)|
|7	|CS|	輸入|	低電壓時，為啟動狀態高電壓時，為閒置狀態|
|8|	BLK	||	LED 背光 電源，接受 5V<br/>(TFT IPS LCD 引腳)|

## 顏色深度

數碼顏色深度，通常都使用 24位元 ，即是以 紅、綠、藍 三原色為基礎，各使用 8位元，甚至更高顏色深度雖然 ST7789 可以設定使用 24 位元顏色深度 ，實際上記憶體未能支援
ST7789 還有 12 位元 、 16 位元 、 18 位元 顏色深度，預設是使用 16 位元顏色深度

### 12位元顏色深度

12位元顏色深度 共有4096種顏色，能夠讓紅、綠、藍平均分配，各使用4位元：

![Alt 12 color](../assets/img/esp/color12.png)

## 16位元顏色深度

16位元顏色深度 共有65536種顏色，不能夠讓紅、綠、藍平均分配，紅藍各使用5位元，綠色使用6位元:

![Alt 16 color](../assets/img/esp/color16.png)

## 18位元顏色深度

18位元顏色深度 共有262144種顏色，能夠讓紅、綠、藍平均分配，各使用6位元：

![Alt 18 color](../assets/img/esp/color18.png)

```c
unsigned long convert24to18(unsigned long rgb) {
    unsigned long r = (rgb >> 16) & 0xFF;
    unsigned long g = (rgb >> 8) & 0xFF;
    unsigned long b = rgb & 0xFF;
    r = map(r, 0x00, 0xFF, 0x00, 0x3F) << 16;
    g = map(g, 0x00, 0xFF, 0x00, 0x3F) << 8;
    b = map(b, 0x00, 0xFF, 0x00, 0x3F);
    return r | g | b;
}
 
unsigned long convert24to16(unsigned long rgb) {
    unsigned long r = (rgb >> 16) & 0xFF;
    unsigned long g = (rgb >> 8) & 0xFF;
    unsigned long b = rgb & 0xFF;
    r = map(r, 0x00, 0xFF, 0x00, 0x1F) << 11;
    g = map(g, 0x00, 0xFF, 0x00, 0x3F) << 5;
    b = map(b, 0x00, 0xFF, 0x00, 0x1F);
    return r | g | b;
}
 
unsigned long convert24to12(unsigned long rgb, bool isFirst) {
    unsigned long r = (rgb >> 16) & 0xFF;
    unsigned long g = (rgb >> 8) & 0xFF;
    unsigned long b = rgb & 0xFF;
    if (isFirst) {
        r = map(r, 0x00, 0xFF, 0x00, 0x0F) << 12;
        g = map(g, 0x00, 0xFF, 0x00, 0x0F) << 8;
        b = map(b, 0x00, 0xFF, 0x00, 0x0F) << 4;
    } else {
        r = map(r, 0x00, 0xFF, 0x00, 0x0F) << 8;
        g = map(g, 0x00, 0xFF, 0x00, 0x0F) << 4;
        b = map(b, 0x00, 0xFF, 0x00, 0x0F);
    }
    return r | g | b;
}
```

## TFT IPS LCD 操作訊號

|CD|	RW|HEX|	說明|
|:---:|:---:|:---:|:---|
|0|	0	|0x01|	軟件重設<br/>執行重設後，需要等待最少5毫秒才完成|
|0	|0	|0x10	|設定休眠模式<br/>0x00 = 關閉<br/>0x01 = 開啟|
|0|	0	|0x20|	設定負片模式</br>0x00 = 關閉</br>0x01 = 開啟|
|0|0|	0x26	|設定Gamma修正|
|1|0|X|(1位元組設定值)|
|0|	0|		0x28	|設定熒幕狀態</br>0x00 = 關閉</br>0x01 = 開啟|
|0|	0	|0x2A	|設定寫入欄的範圍
|1|0|X|第1位元組 第15位元 至 第8位元 欄開始位置</br>第2位元組 第7位元 至 第0位元 欄開始位置</br>第3位元組 第15位元 至 第8位元 欄結束位置</br>第4位元組 第7位元 至 第0位元 欄結束位置</br>(4位元組設定值)|
|0	|0	|0x2B	|設定寫入列的範圍|
|1|0|X|第1位元組 第15位元 至 第8位元 列開始位置</br>第2位元組 第7位元 至 第0位元 列開始位置</br>第3位元組 第15位元 至 第8位元 列結束位置</br>第4位元組 第7位元 至 第0位元 列結束位置</br>(4位元組設定值)|
|0	|0	|0x2C|	寫入內容</br>位元組數量與寫入欄及列的範圍相應如果設定寫入|
|1|0|X|欄的範圍為 0 至 9 ，列的範圍為 0 至 4 便需要寫入 10欄 x 5列 共 50個位元組資料</br>(多位元組設定值)|
|0|	0|	0x33|	設定捲動範圍
|1|0|X|第1位元組 第15位元 至 第8位元 固定的頂部高度</br>第2位元組 第7位元 至 第0位元 固定的頂部高度</br>第2位元組 第15位元 至 第8位元 捲動的內容高度</br>第2位元組 第7位元 至 第0位元 捲動的內容高度</br>第3位元組 第15位元 至 第8位元 固定的底部高度</br>第3位元組 第7位元 至 第0位元 固定的底部高度</br>T + S + B = 320 ，否則無效，會重設</br>(6位元組設定值)|
|0|	0|	0x34	|設定畫面撕裂模式</br>0x00 = 關閉</br>0x01 = 開啟|
|0	|0|	0x37	|設定捲動列數|
|1|0|X|第1位元組 為 第15位元 至 第8位元</br>第2位元組 為 第7位元 至 第0位元</br>(2位元組設定值)|
|0	|0|0x38|	設定閒置模式</br>0x00 = 關閉</br>0x01 = 開啟|
|0|	0|	0x3A	|設定記憶體用量及顏色深度|
|1|0|X|前4位元0B0<font color="#FF1000">???</font>0000 為使用記憶體用量</br>0x03 - 12位元記憶體</br>0x05 - 16位元記憶體</br>0x06 - 18位元記憶體</br>0x07 - 24位元記憶體</br>後4位元0B00000<font color="#FF1000">???</font> 為使用顏色深度</br>0x03 - 12位元顏色深度</br>0x05 - 16位元顏色深度</br>0x06 - 18位元顏色深度</br>0x07 - 24位元顏色深度</br>(1位元組設定值)|
|0	|0	|0x51|	設定光度數值|
|1|0|X|(1位元組設定值)|