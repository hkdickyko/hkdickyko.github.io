---
category: [軟件]
tags: [電腦]
title: Docker (DeepIn)
date: 2023-06-01 1:00:00
---

<style>
  table {
    width: 100%
    }
  td {
    vertical-align: center;
    text-align: center;
  }
  table.inputT{
    margin: 10px;
    width: auto;
    margin-left: auto;
    margin-right: auto;
    border: none;
  }
  input{
    text-align: center;
    padding: 0px 10px;
  }
  iframe{
    width: 100%;
    display: block;
    border-style:none;
    overflow:hidden;
  }
</style>

# Docker 简介

软件开发最大的麻烦事是环境配置。各计算机的环境都不相同，怎么知道软件能在那些机器跑起来？一般必须保证两件事。操作系统的设置，各种库和组件的安装都正确，软件才能运行。

**Docker** 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样。有了 Docker，就不用担心环境问题。

而且 **Docker** 的接口相当简单，可以方便地创建和使用容器，把应用放入容器。容器还可以进行版本管理、复制、分享、修改，就像管理普通的代码一样。

**Docker** 的主要用途，目前有三大类。

 - <font color="#5800FF">提供一次性的环境</font>。如测试其它的软件、持续集成的时候提供单元测试和构建的环境。

 - <font color="#5800FF">提供弹性的云服务</font>。因为 Docker 容器可以随开随关，很适合动态扩容和缩容。

 - <font color="#5800FF">组建微服务架构</font>。通过多个容器，一台机器可以跑多个服务，因此在本机就可以模拟出微服务架构。


## 以下是最基本 shell 脚本用在 deepin 下安装 docker


```
#!/bin/sh

# 将 docker-ce 添加到 Deepin Linux 仓库的 shell 脚本

# 删除旧的 docker 系统
sudo apt-get remove -y docker docker-engine docker.io containerd runc

# 安装依赖档案
sudo apt-get install -y apt-transport-https ca-certificates curl gnupg2 software-properties-common
    
# 添加 GPG 和指纹
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -
sudo apt-key fingerprint 0EBFCD88

# 在 deepin 源列表中添加 debian 仓库
printf 'deb [arch=amd64] https://download.docker.com/linux/debian buster stable\n' \
| sudo tee /etc/apt/sources.list.d/docker-ce.list

# 更新包并安装
sudo apt-get update -y
sudo apt-get install -y docker-ce

# 将当前用户添加到 docker 用户组（可选）
sudo usermod -aG docker $(whoami)
```

## docker 的删除方法

```
sudo apt-get purge docker-ce
sudo apt-get purge docker-ce-cli
sudo rm -rf /var/lib/docker
```

### 列出 docker 信息验证是否安装成功

```
$ docker version
# 或者
$ docker info
```

### 安装完成后可进行以下测试

```
docker images
docker ps -a
```

Docker 需要用户具有 sudo 权限，为了避免每次命令都输入sudo，可以把用户加入 Docker 用户组。

```
$ sudo usermod -aG docker $USER
```

Docker 是服务器----客户端架构。命令行运行docker命令的时候，需要本机有 Docker 服务。如果这项服务没有启动，可以用下面的命令启动。

```
# service 命令的用法
$ sudo service docker start

# systemctl 命令的用法
$ sudo systemctl start docker
```

Docker 把应用程序及其依赖，打包在 image 文件里面。只有通过这个文件，才能生成 Docker 容器。image 文件可以看作是容器的模板。Docker 根据 image 文件生成容器的实例。同一个 image 文件，可以生成多个同时运行的容器实例。

image 是二进制文件。实际开发中，一个 image 文件往往通过继承另一个 image 文件，加上一些个性化设置而生成。

```
# 列出本机的所有 image 文件。
$ docker image ls

# 删除 image 文件
$ docker image rm [imageName]
```

## image 文件介绍

image 文件是通用的，一台机器的 image 文件拷贝到另一台机器，就能直接使用。为了节省时间，应尽量使用制作好的 image 文件。即使要定制，也应该基于已有的 image 文件进行加工，而不是从零开始制作。

为了方便共享，image 文件制作完成后，可以上传到网上的仓库。Docker 的官方仓库 Docker Hub 是最重要、最常用的 image 仓库。此外，出售独立制作的 image 文件也是可以的。

### 抓取官方的 image

由于 Docker 官方提供的 image 文件，都放在 library 组里面，所以它是默认的目录被省略。

```
$ docker image pull hello-world
```

抓取成功以后，就可以在本机看到这个 image 文件。注 hello-world 为 image 二进制文件。

### 查看下载 image 文件

```
$ docker image ls
```


## 在 docker 內安装 Wireguard-easy


[Wireguard-easy網上资源](https://hub.docker.com/r/weejewel/wg-easy)

```
$ docker run -d \
  --name=wg-easy \
  -e WG_HOST=61.238.204.44 \
  -e PASSWORD=admin \
  -e WG_DEFAULT_DNS=8.8.8.8,8.8.4.4 \
  -v ~/.wg-easy:/etc/wireguard \
  -p 51820:51820/udp \
  -p 51821:51821/tcp \
  --cap-add=NET_ADMIN \
  --cap-add=SYS_MODULE \
  --sysctl="net.ipv4.conf.all.src_valid_mark=1" \
  --sysctl="net.ipv4.ip_forward=1" \
  --restart unless-stopped \
  weejewel/wg-easy
```

要在电脑上我开通 51820 及 51821 端口， 用以作为 Wireguard 及Wireguard-ui 的通信端口。

用浏览器，输入 WG_HOST 的 IP 及:51821 (61.238.204.44:51821) 来你连接 Wireguard-ui。