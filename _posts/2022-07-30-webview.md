---
category: [系統]
tags: [編程]
title: WebView 使用技巧
date: 2022-07-30 06:00:00
---

# 如何安裝存儲庫至 Deepin

下載並解壓: [互聯網上的 Webview 軟件包](https://github.com/webview/webview#linux-and-bsd)

一個用於 C/C++ 的 webview 庫，是為使用的平台創建一個通用的 HTML5 UI 抽象層。支持雙向 JavaScript 綁定（從 C/C++ 調用 JavaScript 和從 JavaScript 調用 C/C++）。

# 在 Deepin 下如何安裝並編譯存儲庫

開發需要 GTK 和 WebKit2GTK 庫。需要檢查您的軟件包存儲庫。

安裝相關的 webkit 軟件至 Deepin 電腦系統：

 - <font color="#FF1000">開發版</font>： sudo apt-get install libgtk-3-dev libwebkit2gtk-4.0-dev
 - <font color="#FF1000">發行版</font>： sudo apt-get install libgtk-3-0 libwebkit2gtk-4.0-37

## C 源文件創建 webview 程序 (main.c)

```c
#include "webview.h"
#include <stdio.h>
#include <string.h>

typedef struct {
  webview_t w;
  unsigned int count;
} context_t;

static const char html[] =
    "<button id=\"increment\">Tap me</button>\n"
    "<div>You tapped <span id=\"count\">0</span> time(s).</div>\n"
    "<script>\n"
    "  const [incrementElement, countElement] =\n"
    "    document.querySelectorAll(\"#increment, #count\");\n"
    "  document.addEventListener(\"DOMContentLoaded\", () => {\n"
    "    incrementElement.addEventListener(\"click\", () => {\n"
    "      window.increment().then(result => {\n"
    "        countElement.textContent = result.count;\n"
    "      });\n"
    "    });\n"
    "  });\n"
    "</script>";

void increment(const char *seq, const char *req, void *arg) {
  context_t *context = (context_t *)arg;
  char count_string[10] = {0};
  sprintf(count_string, "%u", ++context->count);
  char result[21] = {0};
  strcat(result, "{\"count\": ");
  strcat(result, count_string);
  strcat(result, "}");
  webview_return(context->w, seq, 0, result);
}

int main() {
  webview_t w = webview_create(0, NULL);
  context_t context = {.w = w, .count = 0};
  webview_set_title(w, "Bind Example");

  webview_set_size(w, 480, 320, WEBVIEW_HINT_NONE);
  webview_bind(w, "increment", increment, &context);

  webview_set_html(w, html);
  webview_run(w);
  webview_destroy(w);
  return 0;
}
```

## 編譯 C 源文件的 shell 腳本 (webview.sh)

```shell
mkdir build
g++ -c webview.cc -std=c++11 $(pkg-config --cflags gtk+-3.0 webkit2gtk-4.0) -o build/webview.o
gcc -c main.c -std=c99 -Iwebview -o build/main.o
g++ build/main.o build/webview.o $(pkg-config --libs gtk+-3.0 webkit2gtk-4.0) -o build/main
./build/main
```
 ## 文件的編譯示例程序

![Alt text](../assets/img/misc/webviewdir.png)

## 在終端使用腳本文件編譯程序

```shell
chmod 777 webview.sh
./webview.sh
```

