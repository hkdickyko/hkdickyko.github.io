---
category: [積體電路]
tags: [IoT, 编程]
title: ESP IMU 惯性测量单元
date: 2024-10-3 1:00:00
---
<style>
  table {
    width: 100%
    }
  td {
    vertical-align: center;
    text-align: center;
  }
  table.inputT{
    margin: 10px;
    width: auto;
    margin-left: auto;
    margin-right: auto;
    border: none;
  }
  input{
    text-align: center;
    padding: 0px 10px;
  }
  iframe{
    width: 100%;
    display: block;
    border-style:none;
  }
</style>

# IMU 惯性测量单元

**IMU**（Inertial Measurement Unit）惯性测量单元：加速度计，陀螺仪构成，输出加速度和角速度，并可以解算出姿态，结合加速度和角速度计可以获得较为准确的 Roll 和 Pitch（旋转轴与重力方向垂直），yaw （旋转轴与重力方向平行）主要通过角速度积分获得，会有偏移误差无法长时间使用。

**AHRS**（Attitude and Heading Reference System）航姿参考系统：由加速度计，磁力计，陀螺仪构成，输出加速度，角速度和姿态，其中姿态是联合三个传感器解算出来，其中磁力计可以通过地磁获得绝对姿态。


## ESP MPU 9250 九轴传感器

传感器本身的噪声和误差，单独使用其中一个传感器进行姿态估计会存在一定程度的不准确性。为了提高精度和可靠性，可以使用扩展卡尔曼滤波（EKF）算法将这些不同传感器的数据进行融合处理。

MPU9250 是一种集成了三轴陀螺仪、三轴加速度计和三轴磁力计的九轴传感器。陀螺仪可以测量物体的角速度，加速度计可以测量物体的加速度，磁力计可以测量物体所受的磁场。数据融合的意义与挑战 在许多应用中，例如导航和姿态估计，需要准确地获取物体的姿态信息。然而，单独使用陀螺仪或加速度计进行姿态估计会存在一定程度的误差。陀螺仪存在漂移问题，长时间使用会导致姿态估计的误差累积；加速度计受重力等因素影响较大，短时间内的姿态估计较准确。因此，数据融合成为解决这一问题的有效手段。

### EKF算法理论基础 
 - 扩展卡尔曼滤波是卡尔曼滤波的一种扩展，用于非线性系统的状态估计。它通过在每一步迭代中对状态和协方差进行线性化来近似非线性系统。EKF通过状态预测和测量更新的方式，根据先验信息和测量信息来更新状态和协方差。
 - 状态量、控制量和观测量 在 MPU9250 的数据融合算法中，选择四元数作为状态量，用来表示物体的姿态；陀螺仪采样值作为控制量，用来更新状态；三轴加速度计和磁偏角作为观测量，用来更新状态和协方差。

### MPU9250 九轴数据融合算法实现
 - 系统模型 根据物体的运动学方程和测量模型，可以建立物体的状态预测和测量更新模型。在状态预测中，利用陀螺仪的测量值对状态进行更新；在测量更新中，利用加速度计和磁偏角的测量值对状态和协方差进行更新。

### EKF算法实现步骤

 - 初始化算法： 设置初始状态和初始协方差矩阵。
 - 状态预测： 利用陀螺仪的测量值进行状态的预测和协方差的更新。
 - 测量更新： 利用加速度计和磁偏角的测量值进行状态和协方差的更新。
 - 循环迭代： 重复执行步骤 **2** 和 **3**，融合每一时刻的陀螺仪、加速度计和磁偏角数据。

MPU9250 由 **2** 部分组成。
 - 一组是 **3** 轴加速度还有 **3** 轴陀螺仪，
 - 另一组则是 AKM 公司的 AK8963 轴磁力计。

所以，MPU9250 是一款 **9** 轴运动跟踪装置。封装中融合了 **3** 轴加速度，**3** 轴陀螺仪以及数字运动处理器 (DMP) 并且兼容 MPU6515。其完美的 I<sup>2</sup>C 方案，可直接输出 **9** 轴的全部数据。

实现 MPU9250 数据融合算法需要以下几个步骤。
 - 传感器校准，包括陀螺仪的零偏校准、加速度计的零偏和比例校准、磁力计的零偏和刻度校准
 - 通过陀螺仪获得初始姿态估计，并根据加速度计的测量结果进行积分误差校正
 - 利用扩展卡尔曼滤波算法进行数据融合，更新状态量和协方差矩阵。
