---
category: [編程]
tags: [IoT, 電子]
title: MD 图
date: 2025-04-06 1:00:00
---

<style>
  table {
    width: 100%
    }
  td {
    vertical-align: center;
    text-align: center;
  }
  table.inputT{
    margin: 10px;
    width: auto;
    margin-left: auto;
    margin-right: auto;
    border: none;
  }
  input{
    text-align: center;
    padding: 0px 10px;
  }
  iframe{
    width: 100%;
    display: block;
    border-style:none;
  }
  
</style>

<script src="../assets/plugin/mermaid.min.js"></script>


# Markdown 图

以下简写代表:

|简写|符号意义|
|:---:|:---:|
|W ->| 是写入|
|R <-|是读出|
|V|为数值|
|0x??|?? 为地址|
|>> ?|二進制位移後，? 为多少個位数|
|<< ?|二進制位移前，? 为多少個位数|
|t = ?|加計时器 ? 为延迟毫秒数|


|目的|指令|读/写|库|代码|解释|
|:---:|:---:|:---:|:---:|:---:|:---|
|设置设备库|REG_BANK_SEL<br>0x7F [5:4]|写入|-|0x7F, BANK << 4|BANK:0\|1\|2\|3 选择用户库|
|读设备 ID|WHO_AM_I<br>0x00|读出|0|0x00|指示正在访问哪个设备|
|重置设备|PWR_MGMT_1<br>0x06 [7]|写入|0|0x06, 0x80|写入 1 即可设置复位|
|设时钟源|PWR_MGMT_1<br>0x06 [2:0]|写入|0|0x06, 0x01|0：内部 20 MHz 振荡器<br>1-5：自动选择最佳可用时钟源<br>6：内部 20 MHz 振荡器<br>7：停止时钟并|
|全开加速度计<br>和陀螺仪|PWR_MGMT_2<br>0x07 [5:0]|写入|0|0x07, 0x00|0x00全开<br>0x07只开加速度<br>0x38只开陀螺仪|
|设置陀螺仪<br>采样率|GYRO_SMPLRT_DIV<br>0x00 [7:0] |写入|2|0x00, rate|此寄存器仅在 FCHOICE = 1'b1<br>(FCHOICE_B 寄存器位为 1'b0)<br>且 (0<DLPF_CFG<7) 时有效。<br>ODR (输出数据速率) 计算如下:<br>ODR =$\frac{1100}{1+GYRO\_SMPLRT\_DIV}H_z$|
|陀螺仪<br>低通滤波器|GYRO_CONFIG_1<br>0x01 [5:3]|写入|2|0x01, mode << 3|ODR (输出数据速率) 计算如下:<br>ODR = $\frac{1125}{1+GYRO\_SMPLRT\_DIV}H_z$<br>在 GYRO_SMPLRT_DIV 为 0...255|
|陀螺仪<br>量程|GYRO_CONFIG_1<br>0x01 [2:1]|写入|2|0x01, dps << 1|00 = ±250 dps<br>01= ±500 dps<br>10 = ±1000 dps<br>11 = ±2000 dps|
|陀螺仪<br>读写|GYRO_CONFIG_1<br>0x01 [0]|写入|2|0x01, RW|0 – 旁路<br>1 – 启用|
|速度计<br>采样率|ACCEL_SMPLRT_DIV_1<br>0x10 [3:0]<br> ACCEL_SMPLRT_DIV_2<br>0x11 [7:0]|写入|2|0x10, msb<br>0x11 , lsb|msb = 采样率分频器的 MSB (4位)<br>lsb = 采样率分频器的 LSB (8位)<br>ODR (输出数据速率) 计算如下:<br>ODR =$\frac {1125}{1+ACCEL\_SMPLRT\_DIV[11:0]}H_z$|




<div class="mermaid">
sequenceDiagram;
   autonumber;
   participant C as Control; 
   participant I as ICM20948;
   participant A as AK09916;
   note over C,I: set bank V = 0;
   C->>I: W -> 0x7F, V << 4;
   note over C,I: WHO_AM_I = 0x00;
   I-->>C: R <- 0x00;
   note over C,I: reset;
   note over C,I: PWR_MGMT_1 = 1
   C->>I: W -> 0x06, V = 0x00;
   I-->>C: t = 10;
   note over C,I: set clock;
   C->>I: W -> 0x06, V = 0x01;
   note over C, I: set Acc & Gyro ON;
   C->>I: W -> 0x07, V = 0x00;
   alt;
   note over C,I:set bank V = 2;
   C->>I: W -> 0x7F, V << 4;   
   else;
   note over C, I: set Gyro sample rate   
   note over C, I: V = 1.1 kHz/(1+GYRO_SMPLRT_DIV[7:0]);
   C->>I: W -> 0x00, V;
   end;
   alt;
   note over C,I:set bank V = 2;
   C->>I: W -> 0x7F, V << 4;   
   else; 
   note over C,I: set Gyro LowPass filter;
   note over C,I: get current setting;
   I-->>C: R = (R <- 0x01) & 0b10001110;
   note over C,I: enable DLPF;
   C->>I: W-> R | 0x01;
   note over C,I: 250,  500, 1000, 2000;
   note over C,I:0b00, 0b01, 0b10, 0b11;
   note over C,I:V = 0b00 << 1 at 250;
   I-->>C: V =  V << 4;
   note over C,I: ICM20948_GYRO_CONFIG_1 = 0x00;  
   C->>I: W -> 0x01, V;
   end;
   alt;
   note over C,I: set bank V = 2;
   C->>I: W -> 0x7F, V << 4;
   else;
   note over C, I: set Gyro scale;
   I-->>C: R = (R <- 0x01) & 0b11111001; 
   note over C,I: 250,  500, 1000, 2000;
   note over C,I:0b00, 0b01, 0b10, 0b11;
   note over C,I:V = 0b00 << 1 at 250;
   note over C,I: ICM20948_GYRO_CONFIG_1 = 0x00;
   C->>I: W -> 0x01, V;
   end
</div>