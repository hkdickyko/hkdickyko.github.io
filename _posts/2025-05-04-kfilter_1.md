---
category: [編程]
tags: [編程, IoT,工程]
title: Kalman Filter 教程
date: 2025-04-05 01:34:36
---

<style>
  table {
    width: 100%
    }
  td {
    vertical-align: center;
    text-align: center;
  }
  table.inputT{
    margin: 10px;
    width: auto;
    margin-left: auto;
    margin-right: auto;
    border: none;
  }
  input{
    text-align: center;
    padding: 0px 10px;
  }
  iframe{
    width: 100%;
    display: block;
    border-style:none;
  }
</style>

# Kalman Filter 教程 (卡爾曼濾波)


![Alt X](../assets/img/kalman/flowchart.png)

## 测量结果 #1

$$
x_1=\left[\begin{matrix} x_1 \\ y_1 \\ \hat{x_1} \\ \hat{y_1} \end{matrix} \right]=\left[\begin{matrix} x_1 \\ y_1 \\ 0 \\ 0 \end{matrix} \right]
$$

$\hat{x_1}，\hat{y_1}$ 分别为 X 轴及 Y 轴的速度。

$$
P_1=\left[\begin{matrix} 
\sigma_x^2 & \sigma_{xy} & 0 & 0 \\ 
\sigma_{xy} & \sigma_y^2 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0
 \end{matrix}\right]
$$

## 测量结果 #2

$$
x_1=\left[\begin{matrix} x_2 \\ y_2 \\ \hat{x_2} \\ \hat{y_2} \end{matrix} \right]=\left[\begin{matrix} x_2 
\\ y_2 
\\ \frac{x_2-x_1}{\Delta{t}} 
\\ \frac{y_2-y_1}{\Delta{t}}  \end{matrix} \right]
$$

$\hat{x_2}，\hat{y_2}$ 分别为 X 轴及 Y 轴的速度，$\Delta{t}$ 为两组连续数据的时间差。

$$
P_1=\left[\begin{matrix} 
\sigma_x^2 & \sigma_{xy} & 0 & 0 \\ 
\sigma_{xy} & \sigma_y^2 & 0 & 0 \\
0 & 0 & 10^4 & 0 \\
0 & 0 & 0 & 10^4
 \end{matrix}\right]
$$

$10^4$ 为猜测的最初错误值，多次计算后会接近真实值。


## 估计结果 #3


$$
x_p=\left[\begin{matrix} x_2 + \hat{x_2} \Delta{t}
\\ y_2 + \hat{x_y} \Delta{t}
\\ \hat{x_2} 
\\ \hat{y_2} \end{matrix} \right]=\left[\begin{matrix}
1 & 0 & \Delta{t} & 0
\\ 0 & 1 & 0 & \Delta{t}
\\ 0 & 0 & 1 & 0 
\\ 0 & 0 & 0 & 1 
\end{matrix} \right] \times \left[\begin{matrix} x_2 
\\ y_2
\\ \hat{x_2} 
\\ \hat{y_2} \end{matrix} \right]=Ax_2
$$



$$
P_p=\left[\begin{matrix}
1 & 0 & \Delta{t} & 0
\\ 0 & 1 & 0 & \Delta{t}
\\ 0 & 0 & 1 & 0 
\\ 0 & 0 & 0 & 1 
\end{matrix} \right] \times  P_2 \times \left[\begin{matrix}
1 & 0 & 0 & 0
\\ 0 & 1 & 0 & 0
\\ \Delta{t} & 0 & 1 & 0 
\\ 0 & \Delta{t} & 0 & 1 
\end{matrix} \right]=A P_2 A^T 
$$


${x_p}，{P_p}$ 分别为估算的下一组数据及相对应协方差。


## 估计卡爾曼因子

![Alt X](../assets/img/kalman/concept.png)


利用数据融合的思想可以知道，为了求出当前状态下最优的估计值，唯一不知道的量就是计算因子 K。而衡量最优的解的条件是什么呢？显然在概率统计中，方差越小，数据围绕真实值越集中。因此此时的目标就是寻找一个 K 的计算式，这样的 K 使得 $x_i，\hat{x_i}$ 的方差(多元数据使用协方差矩阵的迹)最小。


### 計算卡爾曼计算因子 (因子介於 `0` 到 `1` 之間)

 - 測量設備誤差在整個估計過程中是固定不變的 : $ R $

#### 卡爾曼增益

$$ P_p = \frac {P_p}{P_p + R}$$


![Alt X](../assets/img/kalman/flowcalc.png)