---
category: [積體電路]
tags: [IoT, 編程]
title: 顯示設備
date: 2021-10-15 18:00:00
---

# 顯示設備


[ST7789 連接信息](https://www.instructables.com/Adding-CS-Pin-to-13-LCD/)

[ST7789.py 互聯網資源](https://github.com/peterhinch/micropython-nano-gui)

main.py - 處理最小*MQTT*網絡功能的示例 

```python
from machine import  Pin, SPI
import random
import st7789
import time

spi = SPI(baudrate=40000000, polarity=1, phase=1, sck=Pin(21), mosi=Pin(4), miso=Pin(22)) # MOSI=SDA, SCL=SCK
display = st7789.ST7789(
    spi, 240, 240,
    reset=Pin(5, Pin.OUT),
    dc=Pin(2, Pin.OUT),
)
display.init_display()

while True:
    display.fill(
        st7789.color565(
            random.getrandbits(8),
            random.getrandbits(8),
            random.getrandbits(8),
        ),
    )
    time.sleep(1)

```


![Alt flash](../assets/img/iot/st7789.png)

[在顯示設備中顯示字體](https://github.com/peterhinch/micropython-font-to-py)


main.py - 處理最小*MQTT*網絡功能的示例 

```python
import framebuf
import gc

class TextOut:
    
  def __init__(self, display, font, lineHeight, fgColor=0x0000, bgColor=0xffff, colormap=framebuf.RGB565):
    self.display = display
    self.font = font
    self.lineHeight = lineHeight
    self.fgColor = fgColor
    self.bgColor = bgColor
    self.colormap = colormap

  def _drawChar(self, char, x, y, font, fgColor, bgColor, colormap):
    charmap = framebuf.MONO_HMSB if font.reverse() else framebuf.MONO_HLSB
    glyph, char_height, char_width = font.get_ch(char)
    bufc = bytearray(char_height*char_width*2)
    fbc = framebuf.FrameBuffer(bufc, char_width, char_height, colormap)
    div, mod = divmod(char_width, 8)
    gbytes = div + 1 if mod else div 
    for i in range(char_height):  
        for j in range(char_width): 
            gbyte, gbit = divmod(j, 8)
            if gbit == 0: 
                data = glyph[i * gbytes + gbyte]
                print(".")
            pixel = fgColor if data & (1 << (7 - gbit)) else bgColor
            if pixel == bgColor:
                fbc.pixel(j, i, fgColor)
            else:
                fbc.pixel(j, i, bgColor)
    self.display.blit_buffer(fbc, x, y, char_width, char_height)
    gc.collect()
    gc.mem_free()
    return x+char_width

  def Text(self, text, w, h, top, color=0xffff):
    fbuf = framebuf.FrameBuffer(bytearray(w * h * 2), w, h, self.colormap)
    fbuf.text(text, 0, 0, color)
    self.display.blit_buffer(fbuf, 0, top, w, h)
    gc.collect()
    gc.mem_free()

  def drawText(self, string):
    lines = string.split('\n', 1)
    n = len(lines)
    for i in range(n):
        x = 0
        for char in lines[i]:    
            x = self._drawChar(char, x, i*self.lineHeight, self.font, self.fgColor, self.bgColor, self.colormap)
            
```

main.py - 處理最小*MQTT*網絡功能的示例 

```python
from machine import  Pin, SPI
import random
import st7789
import time
import framebuf
import fonts.courier20 as courier20
import gc
from fonts.textout import TextOut

spi = SPI(baudrate=40000000, polarity=1, phase=1, sck=Pin(21), mosi=Pin(4), miso=Pin(22)) # MOSI=SDA, SCL=SCK
display = st7789.ST7789(
    spi, 240, 240,
    reset=Pin(5, Pin.OUT),
    dc=Pin(2, Pin.OUT),
)
display.init_display()

tout = TextOut(display, courier20, 25)
tout.Text('MicroPython!', 240, 80, 0)
tout.Text('MicroPython!', 240, 80, 80)
tout.Text('MicroPython!', 240, 80, 160)
tout.drawText('MicroPython\n  Hello World!')

```